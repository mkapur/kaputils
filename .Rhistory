month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = N_unique_Trips ) %>%
select(-N_unique_Trips) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis,file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
lcomps.temp2
Nsamp
Nsamp = round(runif(972, 113, 554))
cbind(lcomps.temp2,Nsamp)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = N_unique_Trips ) %>%
select(-N_unique_Trips) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis,file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(-N_unique_Trips) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis,file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(-N_unique_Trips) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis,file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis,file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
rm(list = ls())
ldis <- read.csv("C:/Users/mkapur/Dropbox/UW/assessments/sab_2019/200.00_base_files_29May/100.00_base_files/hklpot_agg/sablefish_discard_lengths.csv")
lcomps = ldis
fleet = "HookAndPot"
writeTable = F
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis, file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis, file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
lbin_inc <- 2
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
i = 1
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
new.ldis
Nsamp = round(runif(13, 113, 554))
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
month = 1
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
fleetno = 1
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
sex =0
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = sex, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = part, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
part = 1
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = part, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
new.ldis
return(new.ldis)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = part, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis, file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(ldis.temp);rm(ldis.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F)
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F, part = 0)
getWCGOP_len <- function(lcomps,
Nsamp = round(runif(13, 113, 554)),
fleet,
fleetno = 1,
lbin_lo = NA,
lbin_hi = NA,
lbin_inc = NA,
month = 1,
sex = 0,
part,
writeTable = F,
writeloc = getwd()) {
## make sure the year column is named readably
names(lcomps)[1] <- 'Year'
for(i in 1:length(fleet)){
lcomps.temp <- lcomps %>% filter(Gear == fleet[i]) %>% select(Year, Prop.wghtd,Lenbin)  %>%
pivot_wider(id_cols = c(Year), names_from = c(Lenbin), values_from= Prop.wghtd) %>%
select(Year, everything())
tidx <- ncol(lcomps.temp)
if(missing(lbin_lo)){
message("lbin_lo not specified. defaulting to min present in dataframe \n")
lbin_lo = with(subset(lcomps, Gear == fleet[i]), min(Lenbin))
}
if(missing(lbin_hi)){
message("lbin_hi not specified. defaulting to max present in dataframe \n")
lbin_hi = with(subset(lcomps, Gear == fleet[i]), max(Lenbin))
}
if(missing(lbin_inc)){
message("lbin_hi not specified. defaulting to 2")
lbin_inc <- 2
}
if(sex == 0){ ## duplicate records if sex = 0
names(lcomps.temp)[2:ncol(lcomps.temp)] <- paste0('X',seq(lbin_lo,lbin_hi,lbin_inc))
lcomps.temp2 <- cbind(lcomps.temp, lcomps.temp[,-1])
lcomps.temp2[,-1] <- round(lcomps.temp2[,-1],6)
names(lcomps.temp2[(tidx+1):ncol(lcomps.temp2)]) <- paste0(names(lcomps.temp2)[2:(tidx)],".1")
} else if(sex != 0){
stop('this function not yet ready for sex != 0, sorry')
}
new.ldis <- cbind(lcomps.temp2,Nsamp) %>% data.frame() %>%
## sex combined -- just duplicated as in examples
mutate(month = month, fleet = fleetno, sex = sex, part = part, Nsamp = Nsamp ) %>%
select(Year, month, fleet, sex, part, Nsamp, everything())
if(writeTable){
write.table(new.ldis, file = paste0(writeloc,"/lcomp_discard_SS_",Sys.Date(),"_",fleet[i],".csv"),row.names = FALSE, sep = " ", quote = F)
cat(paste0('wrote discard rate table for ', fleet[i],' to ',writeloc,"\n"))
}
rm(lcomps.temp);rm(lcomps.temp2); rm(new.ldis)
return(new.ldis)
}## end loop fleets
}
getWCGOP_len(lcomps = ldis, fleet = "HookAndPot", writeTable = F, part = 0)
